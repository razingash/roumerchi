{% load static %}
<!DOCTYPE html>
<html lang="en" data-mode="ligth">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <link rel="icon" type="images/x-icon" href="{% static 'tests/favicon.ico' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'tests/css/core.css' %}">
    {% block additional_css %} {% endblock additional_css %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('menu__toggle').addEventListener('change', function() {
                if (this.checked) {
                    document.body.style.overflow = 'hidden';
                } else {
                    document.body.style.overflow = 'auto';
                }
            });
        });
    </script>
    {% if not request.user.is_authenticated %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            function generateUUID() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }
            // Проверка наличия UUID в sessionStorage
            function checkAndSetUUID() {
                const sessionUUIDKey = 'sessionUUID';
                let uuid = sessionStorage.getItem(sessionUUIDKey);

                if (!uuid) {
                    // UUID не найден, создаем новый
                    uuid = generateUUID();
                    sessionStorage.setItem(sessionUUIDKey, uuid);
                    console.log(`UUID не найден. Создан новый UUID: ${uuid}`);
                } else {
                    console.log(`Найден UUID: ${uuid}`);
                }
                return uuid;
            }

            // Вызов функции проверки и создания UUID
            const sessionUUID = checkAndSetUUID();
            console.log(`visitor uuid: ${sessionUUID}`);
        });
    </script>
    {% endif %}
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <meta name="csrf-token" content="{{ csrf_token }}">
    {% if request.user.is_authenticated %}
    <meta name="user-uuid" content="{{ user_uuid }}">
    {% endif %}
    {% block additional_meta_tags %}{% endblock %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    {% block additional_js %} {% endblock additional_js %}
</head>
<body>
<svg class="svg__list" xmlns="http://www.w3.org/2000/svg">
    <symbol id="icon_test_in_progress" viewBox="0 0 20 20">
        <circle cx="10" cy="10" r="8" fill="#000"></circle>
        <path d="M 10 10 L 10 2 A 8 8 0 0 1 15.656 4.344 Z" fill="orange"></path>
    </symbol>
    <symbol id="icon_test_completed" viewBox="0 0 20 20">
        <circle cx="10" cy="10" r="8" fill="#000"></circle>
        <path d="M7 10 l2 2 l5 -5" stroke="#4f0" stroke-width="2" fill="none"></path>
    </symbol>
    <symbol id="icon_cross_rectangular" viewBox="0 0 20 20">
        <path d="m0 18.45 1.5502 1.5502 8.4498-8.4498 8.4498 8.4498 1.5502-1.5502-8.4498-8.4498 8.4498-8.4498-1.5502-1.5502-8.4498 8.4498-8.4498-8.4498-1.5502 1.5502 8.4498 8.4498z" fill="#fff" stroke-linejoin="bevel" stroke-miterlimit="0"></path>
    </symbol>
    <symbol id="icon_user" viewBox="0 0 200 200" >
        <g transform="matrix(1.0078 0 0 1.0078 -67.214 19.407)">
            <g transform="rotate(-44.747 67.792 141.16)">
                <rect transform="rotate(44.747)" x="146.42" y="-107.89" width="200" height="200" fill="#211e1e"></rect><circle transform="rotate(44.747)" cx="245.65" cy="-47.739" r="29.979" fill="none" stroke="#fff" stroke-linejoin="round" stroke-miterlimit="3" stroke-width="1.9845"></circle><g transform="matrix(.74724 1.0974e-8 -1.0974e-8 .74724 -145.82 -59.571)"></g><path d="m40.681 167.84c37.868-30.716 95.332-29.301 131.84 7.0474 35.809 36.06 39.371 92.629 8.0728 131.64z" fill="none" stroke="#fff" stroke-linejoin="round" stroke-miterlimit="3" stroke-width="1.9845"></path>
            </g>
        </g>
    </symbol>
</svg>
    <div class="header__section">
        <div class="header__menu">
            <input id="menu__toggle" type="checkbox">
            <label for="menu__toggle" class="menu__button">
                <span class="menu__bar"></span>
                <span class="menu__bar"></span>
                <span class="menu__bar"></span>
            </label>
            <div class="header__dropdown">
                <div class="dropdown__field">
                    <label for="menu__toggle" class="dropdown__closing">
                        <svg class="svg__cross">
                            <use xlink:href="#icon_cross_rectangular"></use>
                        </svg>
                    </label>
                {% if request.user.is_authenticated %}
                <a href="{% url 'profile' user_uuid %}" class="header__dropdown__item">Profile</a>
                <a href="{% url 'search_test' %}" class="header__dropdown__item" id="search_test">Tests</a>
                <a href="{% url 'logout' %}" class="header__dropdown__item">log out</a>
                {% else %}
                <div class="header__dropdown__auth">
                    <a href="{% url 'registration' %}" class="dropdown__auth__registration">sign up</a>
                    <a href="{% url 'login' %}" class="dropdown__auth__login">sign in</a>
                </div>
                <a href="{% url 'search_test' %}" class="header__dropdown__item" id="search_test">Tests</a>
                {% endif %}
                </div>
            </div>
        </div>
        <a href="{% url 'search_test' %}" class="header__sitename">Roumerchi</a>
        {% if request.user.is_authenticated %}
        <a href="{% url 'profile' user_uuid %}" class="header__user_cover">
            <svg class="svg__user">
                <use xlink:href="#icon_user"></use>
            </svg>
        </a>
        {% else %}
        <a href="{% url 'login' %}" class="header__user_cover">
            <svg class="svg__user">
                <use xlink:href="#icon_user"></use>
            </svg>
        </a>
        {% endif %}
    </div>
    {% block content %}{% endblock content %}
</body>
</html>